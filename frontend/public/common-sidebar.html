<aside class="sidebar">
    <!-- ê²Œì‹œíŒ ë©”ë‰´ -->
    <div class="sidebar-section">
        <div class="sidebar-header">
            <span class="korean-text">ê²Œì‹œíŒ</span>
            <div class="russian-text">Ğ”Ğ¾ÑĞºĞ¸ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ğ¹</div>
        </div>
        <div class="sidebar-menu" id="boardMenuList">
            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
        </div>
    </div>
</aside>

<script>
    // APIì—ì„œ ê²Œì‹œíŒ ë©”ë‰´ ë™ì  ìƒì„±
    const API_BASE_URL = 'http://localhost:8000';

    // í˜„ì¬ í˜ì´ì§€ì˜ slug ì¶”ì¶œ
    function getCurrentSlug() {
        const currentPage = window.location.pathname.split('/').pop();
        const match = currentPage.match(/board-(\w+)\.html/);
        return match ? match[1] : '';
    }

    const CURRENT_SLUG = getCurrentSlug();

    async function loadBoardMenu() {
        try {
            const response = await fetch(`${API_BASE_URL}/api/categories/`);
            if (!response.ok) {
                console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', response.status);
                return;
            }

            const categories = await response.json();
            const menuList = document.getElementById('boardMenuList');

            if (!menuList) {
                console.error('boardMenuList ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            if (categories && categories.length > 0) {
                // í™œì„±í™”ëœ ì¹´í…Œê³ ë¦¬ë§Œ í•„í„°ë§í•˜ê³  sort_orderë¡œ ì •ë ¬
                const activeCategories = categories
                    .filter(cat => cat.is_active)
                    .sort((a, b) => a.sort_order - b.sort_order);

                menuList.innerHTML = activeCategories.map(cat => {
                    const isActive = cat.slug === CURRENT_SLUG ? ' active' : '';
                    // ê·¸ë£¹ í—¤ë”ì¸ ê²½ìš°
                    if (cat.is_group) {
                        return `
                            <div class="sidebar-header" style="margin-top: 20px;">
                                <span class="korean-text">${cat.name_ko || cat.slug}</span>
                                <div class="russian-text">${cat.name_ru || ''}</div>
                            </div>
                        `;
                    }

                    // layout_typeì— ë”°ë¼ í˜ì´ì§€ URL ê²°ì •
                    const isContactForm = cat.layout_type === 'form';
                    const pageUrl = isContactForm ? `/contact-${cat.slug}.html` : `/board-${cat.slug}.html`;

                    // ì¼ë°˜ ê²Œì‹œíŒ ë˜ëŠ” ë¬¸ì˜ ì–‘ì‹
                    return `
                        <a href="${pageUrl}" class="sidebar-item${isActive}">
                            <span class="korean-text">${cat.icon || 'ğŸ“‹'} ${cat.name_ko || cat.slug}</span>
                            <div class="russian-text">${cat.name_ru || ''}</div>
                        </a>
                    `;
                }).join('');
            } else {
                menuList.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #999;">
                        <span class="korean-text">ê²Œì‹œíŒì´ ì—†ìŠµë‹ˆë‹¤</span><br>
                        <span class="russian-text">ĞĞµÑ‚ Ğ´Ğ¾ÑĞ¾Ğº</span>
                    </div>
                `;
            }
        } catch (error) {
            console.error('ê²Œì‹œíŒ ë©”ë‰´ ë¡œë“œ ì˜¤ë¥˜:', error);
            const menuList = document.getElementById('boardMenuList');
            if (menuList) {
                menuList.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #f44336;">
                        <span class="korean-text">ë¡œë“œ ì‹¤íŒ¨</span><br>
                        <span class="russian-text">ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸</span>
                    </div>
                `;
            }
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadBoardMenu);
    } else {
        loadBoardMenu();
    }
</script>
